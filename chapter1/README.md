# Обзор сборок .NET Core

## Архитектура .NET Core
В архитектуре .NET Core можно выделить: 
* .NET Runtime
  * Core CLR (Common Language Runtime) 
  * Core FX - BCL (Base Class Labrary)
* CTS (Common Type System)
* CLS (Common Language Specification)

Исполняющая среда (.NET Runtime) представляет собой коллекцию служб, которые требуются для выполнения скомпилированного кода. 

Полученный в результате компиляции (например csc.exe) двоичный объект, называется *сборкой*.

Сборка включает в себя:
* IL/CIL/MCIL промежуточный код
* Метаданные
* Манифест

### Язык CIL

Все компиляторы .NET Core производят практически идентичный код CIL, что обеспечивает независимость от платформы языка CIL.

Компонент, который транслирует код CIL инструкции ЦП, является оперативным JIT(Just-In-Time) компилятором (jitter). 

Таким образом, достаточно написать единственный блок кода, который затем будет транслироваться JIT-компилятором, специфичным для платформы.

При трансляции инструкций CIL в машинный код JIT-компилятор кеширует результаты в памяти. Благодаря чему, например, при повторном вызове метода, повторная JIT-компиляция производится не будет.

### Метаданные типов

Помимо инструкций CIL сборка .NET Core содержит метаданные, которые описывают каждый определенный в двоичном модуле тип (класс, структуру, перечисление), а также члены каждого типа (свойства, методы, события).

Метаданные используются в средстве IntelliSense, инструментах отладки, компиляторе С#, при использовании рефлексии или сериализации объектов.

### Манифест сборки

Сборка .NET Core также содержит метаданные, которые описывают ее саму - манифест.

Манифест документирует все внешние сборки, которые задействованы в проекте, номер версии сборки, информацию об авторских правах.

### Общая система типов (CTS)

Сборка содержит любое количество различающихся *типов*. Тип — это термин, обозначающий класс, интерфейс, структуру, перечисление или делегат.

CTS является спецификацией, которая документирует, каким образом должны быть определены типы для их дальнейшего использования в .NET Runtime.

Типы располагает любым количеством *членов*.  Член типа ограничен набором (например конструктор, финализатор, статический конструктор, вложенный тип, операция, метод, свойство, индексатор, поле, поле только для чтения, константа, событие).

В спецификации CTS определены *характеристики* членов. Например, член может иметь область видимости (открытый, закрытый или защищенный), быть объявлен абстрактным или виртуальным, статическим или членом экземпляра. 

В конкретном языке для объявления фундаментального типа данных имеется уникальное ключевое слово, однако ключевые слова в языках .NET Core распознаются как один и тот же тип CTS, определенный в сборке по имени mscorlib.dll.

### Общеязыковая спецификация (CLS)

Спецификация CLS — это набор правил, описывающих минимальное и полное множество характеристик, поддерживаемых конкретным компилятором .NET Core для всех .NET Core языков. 

CLS является подмножеством функциональности, определенной в CTS.

Правила CLS можно применить только к тем частям типа, которые видны извне сборки.

Уведомить компилятор .NET Core о необходимости проверки кода на на совместимость с CLS можно с помощью атрибута:
```csharp
[assembly: CLSCompliant(true)]
```

## Пространства имен и сборки

Пространство имен — это группа семантически родственных типов, которые содержатся в одной или нескольких связанных друг с другом сборках. 

Любой язык .NET Core использует те же самые пространства имен и те же самые типы, определенные в библиотеке базовых класов (BCL).

В языке C# для определения ссылки на тип пространства имен используется оператор ``using``:
```csharp
using System;
```

В результате можно выполнить следующую строчку кода:
```csharp
Console.WriteLine("Hello World!");
```

Без оператора ``using`` код можно записать:
```csharp
System.Console.WriteLine("Hello World!");
```

Любой из подходов в сущности дает один и тот же самый код CIL и не влияет ни на производительность, ни на размер сборки.

В среде Windows каждая версия исполняющей среды и SDK устанавливаются в C:\Program Files\dotnet.

Расположение внешних сборок указывается компилятору с помощью IDE. В проектах .NET Core внешние сборки могут быть добавлены с помощью пакетов NuGet.

Утилита ildasm.exe (Intermediate Language Disassembler) дает возможность загрузить любую сборку .NET Core и изучить ее содержимое (манифест, код CIL и метаданные типов).

Следующая команда создаст файл по имени csharp.il и запишет в него все доступные данные:
```
ildasm /all /METADATA /out=csharp.il calc.cs.dll
```

## Литература
1. [Структура и модель выполнения .NET Core приложений](https://habr.com/ru/company/nix/blog/327686/)
2. [CLR, BCL, CIL and assemblies in .Net framework](https://medium.com/@v.cheshmi/clr-bcl-cil-and-assemblies-in-net-framework-3de8bf09e781)
3. [Компилятор csc.exe](https://professorweb.ru/my/csharp/charp_theory/level2/2_2.php)
